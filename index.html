<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>chapTAP Autofix - Roadside Assistance Kenya</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect } = React;

const calculateDistance = (lat1, lon1, lat2, lon2) => {
  const R = 6371;
  const dLat = (lat2 - lat1) * Math.PI / 180;
  const dLon = (lon2 - lon1) * Math.PI / 180;
  const a =
    Math.sin(dLat / 2) * Math.sin(dLat / 2) +
    Math.cos(lat1 * Math.PI / 180) *
      Math.cos(lat2 * Math.PI / 180) *
      Math.sin(dLon / 2) *
      Math.sin(dLon / 2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  return (R * c).toFixed(1);
};

const Phone = () => <span>ğŸ“</span>;
const Message = () => <span>ğŸ’¬</span>;
const Star = () => <span>â­</span>;
const Pin = () => <span>ğŸ“</span>;
const Alert = () => <span>ğŸš¨</span>;
const Bell = () => <span>ğŸ””</span>;
const Toggle = ({ on }) => <span>{on ? "ğŸŸ¢" : "ğŸ”´"}</span>;
const Camera = () => <span>ğŸ“¸</span>;
const Map = () => <span>ğŸ—ºï¸</span>;

const App = () => {
  const [role, setRole] = useState("user");
  const [view, setView] = useState("home");
  const [userLocation, setUserLocation] = useState(null);
  const [locationLoading, setLocationLoading] = useState(false);
  const [providers, setProviders] = useState([
    { id: 1, name: "Mike Garage", phone: "0721122334", services: ["Towing", "Tyre"], location: "Nyali", lat: -4.0435, lng: 39.6682, rating: 4.5, status: "Approved", available: true },
    { id: 2, name: "Quick Fix Auto", phone: "0733445566", services: ["Battery"], location: "CBD", lat: -4.0559, lng: 39.663, rating: 4.3, status: "Approved", available: true }
  ]);
  const [requests, setRequests] = useState([]);
  const [showEmergency, setShowEmergency] = useState(false);
  const [showAdminAuth, setShowAdminAuth] = useState(false);
  const [showProviderAuth, setShowProviderAuth] = useState(false);
  const [adminPin, setAdminPin] = useState("");
  const [providerPhone, setProviderPhone] = useState("");
  const [currentProviderId, setCurrentProviderId] = useState(null);
  const [notifications, setNotifications] = useState([]);
  const [emergencyData, setEmergencyData] = useState({ issue: "", location: "", type: "roadside", customIssue: "", photos: [] });
  const [photoPreview, setPhotoPreview] = useState([]);

  const addNotif = (msg) =>
    setNotifications([{ id: Date.now(), msg, time: new Date().toLocaleTimeString() }, ...notifications]);

  const getUserLocation = () => {
    setLocationLoading(true);
    navigator.geolocation.getCurrentPosition(
      (pos) => {
        setUserLocation({ lat: pos.coords.latitude, lng: pos.coords.longitude });
        setLocationLoading(false);
      },
      () => {
        setLocationLoading(false);
        alert("Enable GPS");
      }
    );
  };

  useEffect(() => {
    getUserLocation();
  }, []);

  return (
    <div className="min-h-screen bg-gray-50 pb-20">
      {/* HEADER */}
      <div className="bg-gradient-to-r from-black to-gray-900 border-b-4 border-yellow-500 p-6 text-center sticky top-0 z-50">
        <h1 className="text-3xl font-black">
          <span className="text-yellow-400">chap</span>
          <span className="text-white">TAP</span>
        </h1>
        <p className="text-yellow-200 text-xs">Autofix - Premium Roadside Assistance</p>
      </div>

      {/* BODY */}
      <div className="max-w-md mx-auto p-4">
        <button
          onClick={() => setShowEmergency(true)}
          className="w-full bg-red-600 text-white py-4 rounded-xl font-black text-lg"
        >
          <Alert /> EMERGENCY HELP
        </button>
      </div>

      {/* FOOTER */}
      <div className="bg-gradient-to-r from-black to-gray-900 border-t-4 border-yellow-500 p-4 text-center fixed bottom-0 left-0 right-0">
        <p className="font-black text-yellow-400">âš«ğŸŸ¡ chapTAP Autofix</p>
        <p className="text-xs text-yellow-200">ğŸ“ support@chaptapautofix.co.ke</p>
      </div>
    </div>
  );
};

ReactDOM.render(<App />, document.getElementById("root"));
</script>
</body>
</html>
