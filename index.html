<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="chapTAP Autofix - Premium roadside assistance in Kenya" />
  <title>chapTAP Autofix - Premium Roadside Assistance Kenya</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // ICONS
    const Phone = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M22 16.92v3a2 2 0 0 1-2.18 2A19.8 19.8 0 0 1 3.26 5.18 2 2 0 0 1 5.11 2h3a2 2 0 0 1 2 1.72 12.8 12.8 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.8 12.8 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
      </svg>
    );
    const MessageCircle = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/>
      </svg>
    );
    const Star = ({ size = 16, filled = true }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill={filled ? "currentColor" : "none"} stroke="currentColor" strokeWidth="2">
        <polygon points="12 2 15 8 22 9 17 14 18 21 12 18 6 21 7 14 2 9 9 8 12 2"/>
      </svg>
    );
    const MapPin = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
        <circle cx="12" cy="10" r="3"/>
      </svg>
    );
    const AlertCircle = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <circle cx="12" cy="12" r="10"/>
        <line x1="12" y1="8" x2="12" y2="12"/>
        <line x1="12" y1="16" x2="12.01" y2="16"/>
      </svg>
    );
    const X = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <line x1="18" y1="6" x2="6" y2="18"/>
        <line x1="6" y1="6" x2="18" y2="18"/>
      </svg>
    );
    const Navigation = ({ size = 16 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polygon points="3 11 22 2 13 21 11 13 3 11"/>
      </svg>
    );
    const Send = ({ size = 20 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <line x1="22" y1="2" x2="11" y2="13"/>
        <polygon points="22 2 15 22 11 13 2 9 22 2"/>
      </svg>
    );
    const Bell = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
        <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
      </svg>
    );
    const Upload = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
        <polyline points="17 8 12 3 7 8"/>
        <line x1="12" y1="3" x2="12" y2="15"/>
      </svg>
    );
    const Check = ({ size = 20 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="20 6 9 17 4 12"/>
      </svg>
    );
    const TrendingUp = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
        <polyline points="17 6 23 6 23 12"/>
      </svg>
    );
    const Users = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
        <circle cx="9" cy="7" r="4"/>
        <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
        <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
      </svg>
    );
    const DollarSign = ({ size = 24 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <line x1="12" y1="1" x2="12" y2="23"/>
        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
      </svg>
    );

    // LOCAL STORAGE UTILITIES
    const storage = {
      get: (key) => {
        try {
          const item = localStorage.getItem(key);
          return item ? JSON.parse(item) : null;
        } catch (e) {
          return null;
        }
      },
      set: (key, value) => {
        try {
          localStorage.setItem(key, JSON.stringify(value));
        } catch (e) {
          console.error('Storage error:', e);
        }
      }
    };

    // MAIN APP
    const ChapTapAutofix = () => {
      const [userType, setUserType] = useState('driver');
      const [currentView, setCurrentView] = useState('home');
      const [providers, setProviders] = useState([]);
      const [shops, setShops] = useState([]);
      const [requests, setRequests] = useState([]);
      const [ratings, setRatings] = useState([]);
      const [chats, setChats] = useState({});
      const [notifications, setNotifications] = useState([]);
      const [location, setLocation] = useState(null);
      const [gpsActive, setGpsActive] = useState(false);
      const [showEmergencyModal, setShowEmergencyModal] = useState(false);
      const [showAdminAuth, setShowAdminAuth] = useState(false);
      const [adminPin, setAdminPin] = useState('');
      const [showNotifications, setShowNotifications] = useState(false);
      const [selectedProvider, setSelectedProvider] = useState(null);
      const [showChat, setShowChat] = useState(false);
      const [showRating, setShowRating] = useState(false);
      const [selectedRequest, setSelectedRequest] = useState(null);

      // Emergency request form
      const [emergencyForm, setEmergencyForm] = useState({
        issue: '',
        locationType: 'roadside',
        locationDesc: '',
        files: []
      });

      // Provider registration form
      const [providerForm, setProviderForm] = useState({
        name: '', phone: '', services: [], experience: '', idNumber: '', location: ''
      });

      // Load data on mount
      useEffect(() => {
        const savedProviders = storage.get('providers') || [
          { id:1, name:'Mike Garage', phone:'0721122334', services:['Towing','Tyre'], location:'Nyali', rating:4.5, status:'Approved', available: true },
          { id:2, name:'Quick Fix Auto', phone:'0733445566', services:['Battery'], location:'CBD', rating:4.3, status:'Approved', available: true },
          { id:3, name:'Roadside Rescue', phone:'0744556677', services:['Towing','Mechanical'], location:'Likoni', rating:4.7, status:'Approved', available: false }
        ];
        setProviders(savedProviders);

        const savedShops = storage.get('shops') || [
          { id:1, name:'Mombasa Oils Centre', location:'Nyali', type:'Lubricants', products:'Engine Oil, Brake Fluid', phone:'0712345678', rating:4.5 },
          { id:2, name:'AutoSpare Hub', location:'Changamwe', type:'Parts', products:'Belts, Plugs', phone:'0721987654', rating:4.3 },
          { id:3, name:'Tyre World', location:'CBD', type:'Tyres', products:'All Tyre Brands', phone:'0733221100', rating:4.6 }
        ];
        setShops(savedShops);

        setRequests(storage.get('requests') || []);
        setRatings(storage.get('ratings') || []);
        setChats(storage.get('chats') || {});
        setNotifications(storage.get('notifications') || []);

        requestLocation();
      }, []);

      // Save data on changes
      useEffect(() => { storage.set('providers', providers); }, [providers]);
      useEffect(() => { storage.set('requests', requests); }, [requests]);
      useEffect(() => { storage.set('ratings', ratings); }, [ratings]);
      useEffect(() => { storage.set('chats', chats); }, [chats]);
      useEffect(() => { storage.set('notifications', notifications); }, [notifications]);

      const requestLocation = () => {
        if (navigator.geolocation) {
          setGpsActive(true);
          navigator.geolocation.getCurrentPosition(
            (position) => {
              setLocation({
                lat: position.coords.latitude,
                lng: position.coords.longitude,
                accuracy: position.coords.accuracy
              });
            },
            () => setGpsActive(false)
          );
        }
      };

      const addNotification = (message, type = 'info') => {
        const newNotif = { id: Date.now(), message, type, timestamp: new Date().toLocaleString() };
        setNotifications(prev => [newNotif, ...prev]);
      };

      const handleEmergencySubmit = () => {
        if (!emergencyForm.issue || !emergencyForm.locationDesc) {
          alert('Please fill all required fields');
          return;
        }

        const newRequest = {
          id: Date.now(),
          ...emergencyForm,
          location: location,
          status: 'Open',
          paymentStatus: 'Pending',
          timestamp: new Date().toLocaleString(),
          driverName: 'Current User'
        };

        setRequests(prev => [newRequest, ...prev]);
        addNotification('Emergency request submitted!', 'success');
        setShowEmergencyModal(false);
        setEmergencyForm({ issue: '', locationType: 'roadside', locationDesc: '', files: [] });
      };

      const handleFileUpload = (e) => {
        const files = Array.from(e.target.files);
        setEmergencyForm(prev => ({ ...prev, files: files.map(f => f.name) }));
      };

      const handleProviderRegistration = () => {
        if (!providerForm.name || !providerForm.phone || providerForm.services.length === 0) {
          alert('Please fill all required fields');
          return;
        }

        const newProvider = {
          id: Date.now(),
          ...providerForm,
          status: 'Pending',
          rating: 0,
          available: false
        };

        setProviders(prev => [...prev, newProvider]);
        addNotification('Registration submitted for approval', 'info');
        setCurrentView('home');
        setProviderForm({ name: '', phone: '', services: [], experience: '', idNumber: '', location: '' });
      };

      const toggleService = (service) => {
        setProviderForm(prev => ({
          ...prev,
          services: prev.services.includes(service)
            ? prev.services.filter(s => s !== service)
            : [...prev.services, service]
        }));
      };

      const approveProvider = (id) => {
        setProviders(prev => prev.map(p => p.id === id ? { ...p, status: 'Approved', available: true } : p));
        addNotification('Provider approved successfully', 'success');
      };

      const rejectProvider = (id) => {
        setProviders(prev => prev.map(p => p.id === id ? { ...p, status: 'Rejected' } : p));
        addNotification('Provider rejected', 'error');
      };

      const sendMessage = (providerId, message) => {
        const chatKey = `chat_${providerId}`;
        const newMessage = { sender: 'user', text: message, timestamp: new Date().toLocaleString() };
        setChats(prev => ({
          ...prev,
          [chatKey]: [...(prev[chatKey] || []), newMessage]
        }));
      };

      const submitRating = (requestId, rating, comment) => {
        const newRating = { id: Date.now(), requestId, rating, comment, timestamp: new Date().toLocaleString() };
        setRatings(prev => [...prev, newRating]);
        setRequests(prev => prev.map(r => r.id === requestId ? { ...r, status: 'Completed' } : r));
        addNotification('Rating submitted. Thank you!', 'success');
        setShowRating(false);
        setSelectedRequest(null);
      };

      const handleAdminAccess = () => {
        if (adminPin === '1234') {
          setUserType('admin');
          setShowAdminAuth(false);
          setCurrentView('home');
        } else {
          alert('Invalid PIN');
        }
      };

      const getStats = () => {
        const totalRequests = requests.length;
        const openRequests = requests.filter(r => r.status === 'Open').length;
        const completedRequests = requests.filter(r => r.status === 'Completed').length;
        const totalRevenue = completedRequests * 500;
        const pendingProviders = providers.filter(p => p.status === 'Pending').length;

        return { totalRequests, openRequests, completedRequests, totalRevenue, pendingProviders };
      };

      const getIssueBreakdown = () => {
        const breakdown = {};
        requests.forEach(r => {
          breakdown[r.issue] = (breakdown[r.issue] || 0) + 1;
        });
        return breakdown;
      };

      const emergencyContacts = [
        { name: 'Police Emergency', number: '999', color: 'bg-blue-600' },
        { name: 'Ambulance', number: '911', color: 'bg-red-600' },
        { name: 'Fire Department', number: '998', color: 'bg-orange-600' },
        { name: 'chapTAP Autofix Support', number: '0712345678', color: 'bg-yellow-600' }
      ];

      const stats = getStats();
      const issueBreakdown = getIssueBreakdown();

      return (
        <div className="min-h-screen bg-gradient-to-b from-gray-50 to-gray-100 pb-24">
          {/* HEADER */}
          <div className="bg-gradient-to-r from-black via-gray-900 to-black border-b-4 border-yellow-500 shadow-xl sticky top-0 z-40">
            <div className="max-w-md mx-auto p-6 text-center relative">
              <h1 className="text-3xl font-black tracking-wider mb-1">
                <span className="text-yellow-400">chap</span>
                <span className="text-white">TAP</span>
              </h1>
              <p className="text-yellow-200 text-xs font-bold">Autofix - Premium Roadside Assistance</p>
              
              {gpsActive && location && (
                <div className="mt-3 inline-flex items-center gap-2 bg-green-500 text-white px-4 py-2 rounded-full text-xs font-bold shadow-lg">
                  <Navigation size={14} />
                  GPS ACTIVE
                </div>
              )}

              {/* User Type Toggle */}
              <div className="mt-4 flex gap-2 justify-center">
                <button
                  onClick={() => { setUserType('driver'); setCurrentView('home'); }}
                  className={`px-4 py-2 rounded-lg font-bold text-xs ${userType === 'driver' ? 'bg-yellow-500 text-black' : 'bg-gray-700 text-white'}`}
                >
                  Driver
                </button>
                <button
                  onClick={() => setShowAdminAuth(true)}
                  className={`px-4 py-2 rounded-lg font-bold text-xs ${userType === 'admin' ? 'bg-yellow-500 text-black' : 'bg-gray-700 text-white'}`}
                >
                  Admin
                </button>
              </div>

              {/* Notifications Bell */}
              <button
                onClick={() => setShowNotifications(!showNotifications)}
                className="absolute top-6 right-6 text-yellow-400 relative"
              >
                <Bell size={24} />
                {notifications.length > 0 && (
                  <span className="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold">
                    {notifications.length}
                  </span>
                )}
              </button>
            </div>
          </div>

          {/* NOTIFICATIONS PANEL */}
          {showNotifications && (
            <div className="max-w-md mx-auto bg-white shadow-xl rounded-b-lg p-4 absolute top-32 left-0 right-0 z-30 max-h-96 overflow-y-auto">
              <div className="flex justify-between items-center mb-4">
                <h3 className="font-bold text-lg">Notifications</h3>
                <button onClick={() => setShowNotifications(false)} className="text-gray-500">
                  <X size={20} />
                </button>
              </div>
              {notifications.length === 0 ? (
                <p className="text-gray-500 text-center py-4">No notifications</p>
              ) : (
                <div className="space-y-2">
                  {notifications.map(n => (
                    <div key={n.id} className={`p-3 rounded-lg ${n.type === 'success' ? 'bg-green-50 border-l-4 border-green-500' : n.type === 'error' ? 'bg-red-50 border-l-4 border-red-500' : 'bg-blue-50 border-l-4 border-blue-500'}`}>
                      <p className="text-sm font-semibold">{n.message}</p>
                      <p className="text-xs text-gray-500 mt-1">{n.timestamp}</p>
                    </div>
                  ))}
                </div>
              )}
            </div>
          )}

          <div className="max-w-md mx-auto p-4">
            {/* DRIVER VIEW */}
            {userType === 'driver' && (
              <>
                {currentView === 'home' && (
                  <div className="space-y-4 mt-4">
                    <button
                      onClick={() => setShowEmergencyModal(true)}
                      className="w-full bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white py-4 rounded-xl font-black text-lg shadow-2xl transform hover:scale-105 transition-all flex items-center justify-center gap-3 border-2 border-red-400"
                    >
                      <AlertCircle size={28} />
                      üö® EMERGENCY HELP
                    </button>

                    <button
                      onClick={() => setCurrentView('providers')}
                      className="w-full bg-gradient-to-r from-black to-gray-800 text-yellow-400 py-4 rounded-xl font-black text-lg shadow-xl hover:shadow-2xl transform hover:scale-105 transition-all border-2 border-yellow-500"
                    >
                      ‚ö´üü° Find Service Providers
                    </button>

                    <button
                      onClick={() => setCurrentView('shops')}
                      className="w-full bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 text-black py-4 rounded-xl font-black text-lg shadow-xl transform hover:scale-105 transition-all border-2 border-yellow-300"
                    >
                      üü° Browse Auto Shops
                    </button>

                    <button
                      onClick={() => setCurrentView('register-provider')}
                      className="w-full bg-gradient-to-r from-blue-600 to-blue-700 text-white py-3 rounded-xl font-bold shadow-lg hover:shadow-xl transition-all"
                    >
                      Register as Service Provider
                    </button>

                    <button
                      onClick={() => setCurrentView('my-requests')}
                      className="w-full bg-gradient-to-r from-purple-600 to-purple-700 text-white py-3 rounded-xl font-bold shadow-lg hover:shadow-xl transition-all"
                    >
                      My Request History ({requests.length})
                    </button>
                  </div>
                )}

                {currentView === 'providers' && (
                  <div className="space-y-4 mt-4">
                    <button onClick={() => setCurrentView('home')} className="text-blue-600 font-bold flex items-center gap-2">
                      ‚Üê Back
                    </button>
                    <h2 className="text-2xl font-black text-gray-800">Service Providers</h2>
                    {providers.filter(p => p.status === 'Approved').map(p => (
                      <div key={p.id} className="bg-white p-5 rounded-xl shadow-lg border-l-4 border-yellow-500">
                        <div className="flex justify-between items-start mb-3">
                          <div>
                            <div className="font-black text-lg">{p.name}</div>
                            <div className="text-sm text-gray-600 flex items-center gap-1">
                              <MapPin size={14} /> {p.location}
                            </div>
                            <div className="text-sm text-blue-600 font-semibold">{p.services.join(' ‚Ä¢ ')}</div>
                            <div className={`inline-block mt-2 px-2 py-1 rounded text-xs font-bold ${p.available ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>
                              {p.available ? 'Available' : 'Busy'}
                            </div>
                          </div>
                          <div className="flex items-center gap-1 bg-yellow-100 px-2 py-1 rounded-full">
                            <Star className="text-yellow-500" size={14} />
                            <span className="font-bold text-sm">{p.rating}</span>
                          </div>
                        </div>
                        <div className="grid grid-cols-3 gap-2 mt-4">
                          <a href={`tel:${p.phone}`} className="bg-blue-600 text-white py-2 rounded-lg text-center text-xs font-bold flex items-center justify-center gap-1">
                            <Phone size={14} /> Call
                          </a>
                          <a href={`https://wa.me/${p.phone.replace(/^0/, '254')}`} target="_blank" className="bg-green-600 text-white py-2 rounded-lg text-center text-xs font-bold flex items-center justify-center gap-1">
                            <MessageCircle size={14} /> WhatsApp
                          </a>
                          <button onClick={() => { setSelectedProvider(p); setShowChat(true); }} className="bg-purple-600 text-white py-2 rounded-lg text-xs font-bold">
                            Chat
                          </button>
                        </div>
                      </div>
                    ))}
                  </div>
                )}

                {currentView === 'shops' && (
                  <div className="space-y-4 mt-4">
                    <button onClick={() => setCurrentView('home')} className="text-blue-600 font-bold flex items-center gap-2">
                      ‚Üê Back
                    </button>
                    <h2 className="text-2xl font-black text-gray-800">Auto Shops</h2>
                    {shops.map(s => (
                      <div key={s.id} className="bg-white p-5 rounded-xl shadow-lg border-l-4 border-blue-500">
                        <div className="flex justify-between items-start mb-2">
                          <div>
                            <div className="font-black text-lg">{s.name}</div>
                            <div className="text-sm text-gray-600 flex items-center gap-1">
                              <MapPin size={14} /> {s.location}
                            </div>
                          </div>
                          <div className="flex items-center gap-1 bg-yellow-100 px-2 py-1 rounded-full">
                            <Star className="text-yellow-500" size={14} />
                            <span className="font-bold text-sm">{s.rating}</span>
                          </div>
                        </div>
                        <div className="bg-blue-50 px-3 py-2 rounded-lg mb-2">
                          <div className="text-xs font-bold text-blue-800 uppercase">{s.type}</div>
                          <div className="text-sm text-gray-700 mt-1">{s.products}</div>
                        </div>
                        <div className="grid grid-cols-2 gap-2 mt-4">
                          <a href={`tel:${s.phone}`} className="bg-blue-600 text-white py-3 rounded-lg text-center font-bold flex items-center justify-center gap-2">
                            <Phone size={16} /> Call
                          </a>
                          <a href={`https://wa.me/${s.phone.replace(/^0/, '254')}`} target="_blank" className="bg-green-600 text-white py-3 rounded-lg text-center font-bold flex items-center justify-center gap-2">
                            <MessageCircle size={16} /> WhatsApp
                          </a>
                        </div>
                      </div>
                    ))}
                  </div>
                )}

                {currentView === 'register-provider' && (
                  <div className="space-y-4 mt-4">
                    <button onClick={() => setCurrentView('home')} className="text-blue-600 font-bold flex items-center gap-2">
                      ‚Üê Back
                    </button>
                    <h2 className="text-2xl font-black text-gray-800">Register as Provider</h2>
                    <div className="bg-white p-6 rounded-xl shadow-lg space-y-4">
                      <input type="text" placeholder="Business Name" value={providerForm.name} onChange={e => setProviderForm({...providerForm, name: e.target.value})} className="w-full p-3 border rounded-lg" />
                      <input type="tel" placeholder="Phone Number" value={providerForm.phone} onChange={e => setProviderForm({...providerForm, phone: e.target.value})} className="w-full p-3 border rounded-lg" />
                      <input type="text" placeholder="Location (e.g., Nyali, CBD)" value={providerForm.location} onChange={e => setProviderForm({...providerForm, location: e.target.value})} className="w-full p-3 borderContinue7:40 PMrounded-lg" />
<input type="text" placeholder="ID Number" value={providerForm.idNumber} onChange={e => setProviderForm({...providerForm, idNumber: e.target.value})} className="w-full p-3 border rounded-lg" />
<input type="text" placeholder="Years of Experience" value={providerForm.experience} onChange={e => setProviderForm({...providerForm, experience: e.target.value})} className="w-full p-3 border rounded-lg" />
                  <div>
                    <p className="font-bold mb-2">Services Offered (select all that apply):</p>
                    <div className="grid grid-cols-2 gap-2">
                      {['Towing', 'Tyre', 'Battery', 'Mechanical', 'Electrical', 'Body Work'].map(service => (
                        <button
                          key={service}
                          onClick={() => toggleService(service)}
                          className={`p-2 rounded-lg border-2 font-semibold ${providerForm.services.includes(service) ? 'bg-yellow-500 border-yellow-600 text-black' : 'bg-white border-gray-300'}`}
                        >
                          {service}
                        </button>
                      ))}
                    </div>
                  </div>

                  <button onClick={handleProviderRegistration} className="w-full bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700">
                    Submit Registration
                  </button>

                  <div className="bg-blue-50 p-4 rounded-lg">
                    <p className="text-sm font-bold text-blue-800 mb-2">What happens next?</p>
                    <ol className="text-xs text-gray-700 space-y-1 list-decimal list-inside">
                      <li>Your application will be reviewed by our admin team</li>
                      <li>You'll receive notification once approved</li>
                      <li>Start receiving service requests from drivers</li>
                    </ol>
                  </div>
                </div>
              </div>
            )}

            {currentView === 'my-requests' && (
              <div className="space-y-4 mt-4">
                <button onClick={() => setCurrentView('home')} className="text-blue-600 font-bold flex items-center gap-2">
                  ‚Üê Back
                </button>
                <h2 className="text-2xl font-black text-gray-800">My Request History</h2>
                {requests.length === 0 ? (
                  <div className="bg-white p-6 rounded-xl shadow text-center text-gray-500">
                    No requests yet
                  </div>
                ) : (
                  requests.map(r => (
                    <div key={r.id} className="bg-white p-5 rounded-xl shadow-lg border-l-4 border-purple-500">
                      <div className="flex justify-between items-start mb-2">
                        <div>
                          <div className="font-bold text-lg">{r.issue}</div>
                          <div className="text-xs text-gray-500">{r.timestamp}</div>
                        </div>
                        <div className={`px-3 py-1 rounded-full text-xs font-bold ${r.status === 'Open' ? 'bg-yellow-100 text-yellow-700' : r.status === 'Completed' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>
                          {r.status}
                        </div>
                      </div>
                      <div className="text-sm text-gray-600 space-y-1">
                        <p><strong>Location Type:</strong> {r.locationType === 'roadside' ? 'üõ£Ô∏è Roadside' : 'üè† Home/Office'}</p>
                        <p><strong>Description:</strong> {r.locationDesc}</p>
                        {r.files?.length > 0 && <p><strong>Attachments:</strong> {r.files.length} file(s)</p>}
                        <p className={`font-semibold ${r.paymentStatus === 'Paid' ? 'text-green-600' : 'text-orange-600'}`}>
                          Payment: {r.paymentStatus}
                        </p>
                      </div>
                      {r.status === 'Completed' && !ratings.find(rat => rat.requestId === r.id) && (
                        <button
                          onClick={() => { setSelectedRequest(r); setShowRating(true); }}
                          className="mt-3 w-full bg-yellow-500 text-black py-2 rounded-lg font-bold hover:bg-yellow-600"
                        >
                          Rate This Service
                        </button>
                      )}
                    </div>
                  ))
                )}
              </div>
            )}
          </>
        )}

        {/* ADMIN VIEW */}
        {userType === 'admin' && (
          <>
            {currentView === 'home' && (
              <div className="space-y-4 mt-4">
                <h2 className="text-2xl font-black text-gray-800">Admin Dashboard</h2>
                
                {/* Stats Cards */}
                <div className="grid grid-cols-2 gap-4">
                  <div className="bg-gradient-to-br from-blue-500 to-blue-600 p-4 rounded-xl shadow-lg text-white">
                    <div className="flex items-center justify-between mb-2">
                      <TrendingUp size={24} />
                      <span className="text-2xl font-black">{stats.totalRequests}</span>
                    </div>
                    <p className="text-sm font-semibold">Total Requests</p>
                  </div>

                  <div className="bg-gradient-to-br from-green-500 to-green-600 p-4 rounded-xl shadow-lg text-white">
                    <div className="flex items-center justify-between mb-2">
                      <Check size={24} />
                      <span className="text-2xl font-black">{stats.completedRequests}</span>
                    </div>
                    <p className="text-sm font-semibold">Completed</p>
                  </div>

                  <div className="bg-gradient-to-br from-yellow-500 to-yellow-600 p-4 rounded-xl shadow-lg text-white">
                    <div className="flex items-center justify-between mb-2">
                      <Users size={24} />
                      <span className="text-2xl font-black">{providers.filter(p => p.status === 'Approved').length}</span>
                    </div>
                    <p className="text-sm font-semibold">Active Providers</p>
                  </div>

                  <div className="bg-gradient-to-br from-purple-500 to-purple-600 p-4 rounded-xl shadow-lg text-white">
                    <div className="flex items-center justify-between mb-2">
                      <DollarSign size={24} />
                      <span className="text-2xl font-black">KES {stats.totalRevenue}</span>
                    </div>
                    <p className="text-sm font-semibold">Revenue</p>
                  </div>
                </div>

                {/* Quick Actions */}
                <div className="bg-white p-4 rounded-xl shadow-lg space-y-3">
                  <h3 className="font-bold text-lg">Quick Actions</h3>
                  <button
                    onClick={() => setCurrentView('pending-approvals')}
                    className="w-full bg-red-600 text-white py-3 rounded-lg font-bold hover:bg-red-700 flex items-center justify-between px-4"
                  >
                    <span>Pending Provider Approvals</span>
                    {stats.pendingProviders > 0 && (
                      <span className="bg-white text-red-600 px-3 py-1 rounded-full text-sm font-black">
                        {stats.pendingProviders}
                      </span>
                    )}
                  </button>
                  <button
                    onClick={() => setCurrentView('all-requests')}
                    className="w-full bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700"
                  >
                    View All Requests
                  </button>
                  <button
                    onClick={() => setCurrentView('all-providers')}
                    className="w-full bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700"
                  >
                    Manage Providers
                  </button>
                </div>

                {/* Issue Breakdown */}
                {Object.keys(issueBreakdown).length > 0 && (
                  <div className="bg-white p-4 rounded-xl shadow-lg">
                    <h3 className="font-bold text-lg mb-3">Issue Breakdown</h3>
                    {Object.entries(issueBreakdown).map(([issue, count]) => (
                      <div key={issue} className="flex justify-between items-center py-2 border-b">
                        <span className="text-sm font-semibold">{issue}</span>
                        <span className="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-sm font-bold">
                          {count}
                        </span>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            )}

            {currentView === 'pending-approvals' && (
              <div className="space-y-4 mt-4">
                <button onClick={() => setCurrentView('home')} className="text-blue-600 font-bold flex items-center gap-2">
                  ‚Üê Back to Dashboard
                </button>
                <h2 className="text-2xl font-black text-gray-800">Pending Approvals</h2>
                {providers.filter(p => p.status === 'Pending').length === 0 ? (
                  <div className="bg-white p-6 rounded-xl shadow text-center text-gray-500">
                    No pending approvals
                  </div>
                ) : (
                  providers.filter(p => p.status === 'Pending').map(p => (
                    <div key={p.id} className="bg-white p-5 rounded-xl shadow-lg border-l-4 border-red-500">
                      <div className="font-black text-lg mb-2">{p.name}</div>
                      <div className="text-sm text-gray-600 space-y-1 mb-4">
                        <p><strong>Phone:</strong> {p.phone}</p>
                        <p><strong>Location:</strong> {p.location}</p>
                        <p><strong>Services:</strong> {p.services.join(', ')}</p>
                        <p><strong>Experience:</strong> {p.experience} years</p>
                        <p><strong>ID:</strong> {p.idNumber}</p>
                      </div>
                      <div className="grid grid-cols-2 gap-2">
                        <button
                          onClick={() => approveProvider(p.id)}
                          className="bg-green-600 text-white py-2 rounded-lg font-bold hover:bg-green-700"
                        >
                          ‚úì Approve
                        </button>
                        <button
                          onClick={() => rejectProvider(p.id)}
                          className="bg-red-600 text-white py-2 rounded-lg font-bold hover:bg-red-700"
                        >
                          ‚úó Reject
                        </button>
                      </div>
                    </div>
                  ))
                )}
              </div>
            )}

            {currentView === 'all-requests' && (
              <div className="space-y-4 mt-4">
                <button onClick={() => setCurrentView('home')} className="text-blue-600 font-bold flex items-center gap-2">
                  ‚Üê Back to Dashboard
                </button>
                <h2 className="text-2xl font-black text-gray-800">All Requests</h2>
                {requests.map(r => (
                  <div key={r.id} className="bg-white p-5 rounded-xl shadow-lg border-l-4 border-blue-500">
                    <div className="flex justify-between items-start mb-2">
                      <div>
                        <div className="font-bold text-lg">{r.issue}</div>
                        <div className="text-xs text-gray-500">{r.timestamp}</div>
                        <div className="text-sm font-semibold text-gray-700 mt-1">{r.driverName}</div>
                      </div>
                      <div className={`px-3 py-1 rounded-full text-xs font-bold ${r.status === 'Open' ? 'bg-yellow-100 text-yellow-700' : r.status === 'Completed' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>
                        {r.status}
                      </div>
                    </div>
                    <div className="text-sm text-gray-600">
                      <p><strong>Location:</strong> {r.locationDesc}</p>
                      <p><strong>Type:</strong> {r.locationType === 'roadside' ? 'üõ£Ô∏è Roadside' : 'üè† Home/Office'}</p>
                      <p className="font-semibold text-orange-600">Payment: {r.paymentStatus}</p>
                    </div>
                  </div>
                ))}
              </div>
            )}

            {currentView === 'all-providers' && (
              <div className="space-y-4 mt-4">
                <button onClick={() => setCurrentView('home')} className="text-blue-600 font-bold flex items-center gap-2">
                  ‚Üê Back to Dashboard
                </button>
                <h2 className="text-2xl font-black text-gray-800">All Providers</h2>
                {providers.map(p => (
                  <div key={p.id} className="bg-white p-5 rounded-xl shadow-lg border-l-4 border-green-500">
                    <div className="flex justify-between items-start mb-2">
                      <div>
                        <div className="font-bold text-lg">{p.name}</div>
                        <div className="text-sm text-gray-600">{p.location}</div>
                        <div className="text-sm text-blue-600">{p.services.join(', ')}</div>
                      </div>
                      <div className="text-right">
                        <div className="flex items-center gap-1 bg-yellow-100 px-2 py-1 rounded-full mb-1">
                          <Star className="text-yellow-500" size={14} />
                          <span className="font-bold text-sm">{p.rating}</span>
                        </div>
                        <div className={`px-2 py-1 rounded text-xs font-bold ${p.status === 'Approved' ? 'bg-green-100 text-green-700' : p.status === 'Pending' ? 'bg-yellow-100 text-yellow-700' : 'bg-red-100 text-red-700'}`}>
                          {p.status}
                        </div>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </>
        )}
      </div>

      {/* EMERGENCY MODAL */}
      {showEmergencyModal && (
        <div className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-2xl max-w-md w-full p-6 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div className="flex justify-between items-center mb-4">
              <h3 className="text-2xl font-black text-red-600 flex items-center gap-2">
                <AlertCircle size={28} />
                Emergency Request
              </h3>
              <button onClick={() => setShowEmergencyModal(false)} className="text-gray-500">
                <X size={24} />
              </button>
            </div>

            <div className="space-y-4">
              <div>
                <label className="block font-bold mb-2">What's the issue?</label>
                <select
                  value={emergencyForm.issue}
                  onChange={e => setEmergencyForm({...emergencyForm, issue: e.target.value})}
                  className="w-full p-3 border rounded-lg"
                >
                  <option value="">Select issue...</option>
                  <option value="Engine Problem">üîß Engine Problem</option>
                  <option value="Battery Dead">üîã Battery Dead</option>
                  <option value="Flat Tyre">üõû Flat Tyre</option>
                  <option value="Out of Fuel">‚õΩ Out of Fuel</option>
                  <option value="Accident">üöó Accident</option>
                  <option value="Other">‚ùì Other</option>
                </select>
              </div>

              <div>
                <label className="block font-bold mb-2">Service Location Type</label>
                <div className="grid grid-cols-2 gap-2">
                  <button
                    onClick={() => setEmergencyForm({...emergencyForm, locationType: 'roadside'})}
                    className={`p-3 rounded-lg border-2 font-semibold ${emergencyForm.locationType === 'roadside' ? 'bg-yellow-500 border-yellow-600 text-black' : 'bg-white border-gray-300'}`}
                  >
                    üõ£Ô∏è Roadside
                  </button>
                  <button
                    onClick={() => setEmergencyForm({...emergencyForm, locationType: 'home'})}
                    className={`p-3 rounded-lg border-2 font-semibold ${emergencyForm.locationType === 'home' ? 'bg-yellow-500 border-yellow-600 text-black' : 'bg-white border-gray-300'}`}
                  >
                    üè† Home/Office
                  </button>
                </div>
              </div>

              <div>
                <label className="block font-bold mb-2">Location Description</label>
                <textarea
                  value={emergencyForm.locationDesc}
                  onChange={e => setEmergencyForm({...emergencyForm, locationDesc: e.target.value})}
                  placeholder="E.g., Near Total Petrol Station, Nyali..."
                  className="w-full p-3 border rounded-lg"
                  rows="3"
                />
              </div>

              <div>
                <label className="block font-bold mb-2">Upload Photos/Videos (Optional)</label>
                <input
                  type="file"
                  multiple
                  accept="image/*,video/*"
                  onChange={handleFileUpload}
                  className="w-full p-2 border rounded-lg text-sm"
                />
                {emergencyForm.files.length > 0 && (
                  <p className="text-sm text-green-600 mt-1">‚úì {emergencyForm.files.length} file(s) selected</p>
                )}
              </div>

              {location && (
                <div className="bg-green-50 p-3 rounded-lg border border-green-200">
                  <p className="text-xs font-bold text-green-800 mb-1">Your GPS Location:</p>
                  <p className="text-xs text-green-700">{location.lat.toFixed(6)}, {location.lng.toFixed(6)}</p>
                </div>
              )}

              <button
                onClick={handleEmergencySubmit}
                className="w-full bg-red-600 text-white py-3 rounded-lg font-bold text-lg hover:bg-red-700"
              >
                Submit Emergency Request
              </button>

              <div className="bg-blue-50 p-4 rounded-lg">
                <p className="text-sm font-bold text-blue-800 mb-2">What happens next?</p>
                <ol className="text-xs text-gray-700 space-y-1 list-decimal list-inside">
                  <li>Your request is sent to nearby service providers</li>
                  <li>Providers will contact you to confirm availability</li>
                  <li>Service provider arrives at your location</li>
                  <li>Rate the service after completion</li>
                </ol>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* CHAT MODAL */}
      {showChat && selectedProvider && (
        <ChatModal
          provider={selectedProvider}
          messages={chats[`chat_${selectedProvider.id}`] || []}
          onClose={() => { setShowChat(false); setSelectedProvider(null); }}
          onSend={(msg) => sendMessage(selectedProvider.id, msg)}
        />
      )}

      {/* RATING MODAL */}
      {showRating && selectedRequest && (
        <RatingModal
          request={selectedRequest}
          onClose={() => { setShowRating(false); setSelectedRequest(null); }}
          onSubmit={submitRating}
        />
      )}

      {/* ADMIN AUTH MODAL */}
      {showAdminAuth && (
        <div className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-2xl max-w-sm w-full p-6 shadow-2xl">
            <h3 className="text-xl font-black text-gray-800 mb-4">Admin Access</h3>
            <input
              type="password"
              placeholder="Enter PIN (default: 1234)"
              value={adminPin}
              onChange={e => setAdminPin(e.target.value)}
              className="w-full p-3 border rounded-lg mb-4"
            />
            <div className="grid grid-cols-2 gap-2">
              <button onClick={handleAdminAccess} className="bg-blue-600 text-white py-2 rounded-lg font-bold">
                Login
              </button>
              <button onClick={() => { setShowAdminAuth(false); setAdminPin(''); }} className="bg-gray-300 text-gray-700 py-2 rounded-lg font-bold">
                Cancel
              </button>
            </div>
          </div>
        </div>
      )}

      {/* FOOTER */}
      <div className="bg-gradient-to-r from-black via-gray-900 to-black border-t-4 border-yellow-500 p-4 text-center fixed bottom-0 left-0 right-0 max-w-md mx-auto shadow-2xl">
        <p className="font-black tracking-wider text-yellow-400 text-lg">‚ö´üü° chapTAP Autofix</p>
        <p className="text-xs text-yellow-200 mt-1">üìû support@chaptapautofix.co.ke | Premium Roadside Help</p>
      </div>
    </div>
  );
};

// CHAT MODAL COMPONENT
const ChatModal = ({ provider, messages, onClose, onSend }) => {
  const [message, setMessage] = useState('');
  const messagesEndRef = useRef(null);

  useEffect(() => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  }, [messages]);

  const handleSend = () => {
    if (message.trim()) {
      onSend(message);
      setMessage('');
    }
  };

  return (
    <div className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-2xl max-w-md w-full h-[600px] flex flex-col shadow-2xl">
        <div className="bg-gradient-to-r from-purple-600 to-purple-700 p-4 rounded-t-2xl flex justify-between items-center">
          <div>
            <h3 className="font-bold text-white">{provider.name}</h3>
            <p className="text-xs text-purple-100">{provider.services.join(', ')}</p>
          </div>
          <button onClick={onClose} className="text-white">
            <X size={24} />
          </button>
        </div>

        <div className="flex-1 overflow-y-auto p-4 space-y-3">
          {messages.length === 0 ? (
            <p className="text-center text-gray-400 mt-8">No messages yet. Start the conversation!</p>
          ) : (
            messages.map((msg, idx) => (
              <div key={idx} className={`flex ${msg.sender === 'user' ? 'justify-end' : 'justify-start'}`}>
                <div className={`max-w-[70%] p-3 rounded-lg ${msg.sender === 'user' ? 'bg-purple-600 text-white' : 'bg-gray-200 text-gray-800'}`}>
                  <p className="text-sm">{msg.text}</p>
                  <p className="text-xs mt-1 opacity-70">{msg.timestamp}</p>
                </div>
              </div>
            ))
          )}
          <div ref={messagesEndRef} />
        </div>

        <div className="p-4 border-t flex gap-2">
          <input
            type="text"
            value={message}
            onChange={e => setMessage(e.target.value)}
            onKeyPress={e => e.key === 'Enter' && handleSend()}
            placeholder="Type a message..."
            className="flex-1 p-3 border rounded-lg"
          />
          <button onClick={handleSend} className="bg-purple-600 text-white p-3 rounded-lg">
            <Send size={20} />
          </button>
        </div>
      </div>
    </div>
  );
};

// RATING MODAL COMPONENT
const RatingModal = ({ request, onClose, onSubmit }) => {
  const [rating, setRating] = useState(0);
  const [comment, setComment] = useState('');

  const handleSubmit = () => {
    if (rating === 0) {
      alert('Please select a rating');
      return;
    }
    onSubmit(request.id, rating, comment);
  };

  return (
    <div className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-2xl max-w-md w-full p-6 shadow-2xl">
        <div className="flex justify-between items-center mb-4">
          <h3 className="text-xl font-black text-gray-800">Rate Service</h3>
          <button onClick={onClose} className="text-gray-500">
            <X size={24} />
          </button>
        </div>

        <div className="mb-4">
          <p className="text-sm text-gray-600 mb-2">Request: {request.issue}</p>
          <p className="text-xs text-gray-500">{request.timestamp}</p>
        </div>

        <div className="mb-4">
          <p className="font-bold mb-2">How was the service?</p>
          <div className="flex gap-2 justify-center">
            {[1, 2, 3, 4, 5].map(star => (
              <button
                key={star}
                onClick={() => setRating(star)}
                className={`text-3xl ${rating >= star ? 'text-yellow-500' : 'text-gray-300'}`}
              >
                ‚òÖ
              </button>
            ))}
          </div>
        </div>

        <div className="mb-4">
          <label className="block font-bold mb-2">Comments (Optional)</label>
          <textarea
            value={comment}
            onChange={e => setComment(e.target.value)}
            placeholder="Share your experience..."
            className="w-full p-3 border rounded-lg"
            rows="3"
          />
        </div>

        <button
          onClick={handleSubmit}
          className="w-full bg-yellow-500 text-black py-3 rounded-lg font-bold hover:bg-yellow-600"
        >
          Submit Rating
        </button>
      </div>
    </div>
  );
};

ReactDOM.render(<ChapTapAutofix />, document.getElementById('root'));
  </script>
</body>
</html>
