<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>chapTAP Autofix</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- React -->
  <script defer crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script defer crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gradient-to-br from-[#f7f3ee] to-[#e6dfd4]">
  <div id="root"></div>

<script defer>
const { useState, useEffect } = React;

function App() {
  const [role, setRole] = useState("user");
  const [requests, setRequests] = useState(
    JSON.parse(localStorage.getItem("requests") || "[]")
  );

  useEffect(() => {
    localStorage.setItem("requests", JSON.stringify(requests));
  }, [requests]);

  return (
    <div className="min-h-screen flex flex-col items-center justify-center p-6">
      <RoleSelector role={role} setRole={setRole} />

      {role === "user" && <User requests={requests} setRequests={setRequests} />}
      {role === "provider" && <Provider requests={requests} setRequests={setRequests} />}
      {role === "admin" && <Admin requests={requests} />}
    </div>
  );
}

/* ---------------- ROLE SELECTOR ---------------- */

function RoleSelector({ role, setRole }) {
  return (
    <div className="mb-6">
      <select
        value={role}
        onChange={e => setRole(e.target.value)}
        className="px-4 py-2 rounded-lg shadow"
      >
        <option value="user">Get Help</option>
        <option value="provider">Service Provider</option>
        <option value="admin">Admin</option>
      </select>
    </div>
  );
}

/* ---------------- USER ---------------- */

function User({ requests, setRequests }) {
  const [issue, setIssue] = useState("");
  const [file, setFile] = useState(null);

  function submitRequest() {
    if (!issue) return alert("Describe the issue");

    setRequests([
      ...requests,
      {
        id: Date.now(),
        issue,
        file: file ? file.name : null,
        status: "Open",
        provider: null
      }
    ]);

    setIssue("");
    setFile(null);
  }

  return (
    <Card title="chapTAP Autofix" subtitle="Premium on-demand help anywhere">
      <textarea
        className="w-full p-3 border rounded mb-3"
        placeholder="Describe the problem (home, office, roadside, etc.)"
        value={issue}
        onChange={e => setIssue(e.target.value)}
      />

      <input
        type="file"
        accept="image/*,video/*"
        className="mb-4"
        onChange={e => setFile(e.target.files[0])}
      />

      <button
        onClick={submitRequest}
        className="w-full bg-black text-gold py-3 rounded-lg text-white font-semibold"
      >
        Request Help
      </button>
    </Card>
  );
}

/* ---------------- PROVIDER ---------------- */

function Provider({ requests, setRequests }) {
  function acceptJob(id) {
    setRequests(
      requests.map(r =>
        r.id === id ? { ...r, status: "In Progress", provider: "You" } : r
      )
    );
  }

  function completeJob(id) {
    setRequests(
      requests.map(r =>
        r.id === id ? { ...r, status: "Completed" } : r
      )
    );
  }

  return (
    <Card title="Available Jobs">
      {requests.map(r => (
        <div key={r.id} className="border p-3 rounded mb-3">
          <p><b>Issue:</b> {r.issue}</p>
          <p><b>Status:</b> {r.status}</p>
          {r.file && <p><b>Attachment:</b> {r.file}</p>}

          {r.status === "Open" && (
            <button
              onClick={() => acceptJob(r.id)}
              className="mt-2 px-4 py-2 bg-green-600 text-white rounded"
            >
              Accept Job
            </button>
          )}

          {r.status === "In Progress" && (
            <button
              onClick={() => completeJob(r.id)}
              className="mt-2 px-4 py-2 bg-blue-600 text-white rounded"
            >
              Mark Completed
            </button>
          )}
        </div>
      ))}
    </Card>
  );
}

/* ---------------- ADMIN ---------------- */

function Admin({ requests }) {
  const total = requests.length;
  const open = requests.filter(r => r.status === "Open").length;
  const completed = requests.filter(r => r.status === "Completed").length;

  return (
    <Card title="Admin Dashboard">
      <p>Total Requests: {total}</p>
      <p>Open: {open}</p>
      <p>Completed: {completed}</p>

      <h3 className="mt-4 font-semibold">All Requests</h3>
      {requests.map(r => (
        <div key={r.id} className="border p-2 rounded mt-2">
          <p>{r.issue}</p>
          <p>Status: {r.status}</p>
        </div>
      ))}
    </Card>
  );
}

/* ---------------- CARD ---------------- */

function Card({ title, subtitle, children }) {
  return (
    <div className="bg-white/80 backdrop-blur-lg rounded-2xl shadow-xl p-8 w-full max-w-xl text-center">
      <h1 className="text-3xl font-serif mb-2">{title}</h1>
      {subtitle && <p className="text-gray-600 mb-6">{subtitle}</p>}
      {children}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
</body>
</html>
