<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>chapTAP Autofix</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>body{padding-bottom:100px}</style>
</head>

<body class="bg-gray-50">
<!-- UI CONTENT UNCHANGED -->
<!-- (everything above Firebase remains EXACTLY the same as you sent) -->

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
import {
  getFirestore, collection, addDoc, onSnapshot,
  updateDoc, doc, deleteDoc, query, orderBy
} from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

const firebaseConfig = {
  apiKey: "AIzaSyC9bElB729BAemQgyloqaFSXOZhgqYjeFY",
  authDomain: "chaptap-autofix.firebaseapp.com",
  projectId: "chaptap-autofix",
  storageBucket: "chaptap-autofix.firebasestorage.app",
  messagingSenderId: "844892869830",
  appId: "1:844892869830:web:17a305b33d0679a068b3c7"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

window.db = db;
window.collection = collection;
window.addDoc = addDoc;
window.onSnapshot = onSnapshot;
window.updateDoc = updateDoc;
window.doc = doc;
window.deleteDoc = deleteDoc;
window.query = query;
window.orderBy = orderBy;

console.log('âœ… Firebase connected!');
</script>

<script>
let role='user',loc=null,type='roadside',pid=null,notifs=[],reqs=[],provs=[];

window.initApp=function(){
  onSnapshot(collection(db,'providers'),s=>{
    provs=[];s.forEach(d=>provs.push({docId:d.id,...d.data()}));
    updateAllCounts();
  });
  onSnapshot(query(collection(db,'requests'),orderBy('timestamp','desc')),s=>{
    reqs=[];s.forEach(d=>reqs.push({docId:d.id,...d.data()}));
    updateAllCounts();
  });
  getLoc();
};

window.addEventListener('load',()=>window.initApp());

function show(id){
  document.querySelectorAll('#user>div,#provider>div,#admin>div')
    .forEach(e=>e.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
  if(id==='pv')renderP();
  if(id==='ur')renderUR();
  if(id==='ar')renderAR();
  if(id==='mj')renderMJ();
}

function renderP(){
  const l=document.getElementById('pl');l.innerHTML='';
  provs.filter(p=>p.status==='Approved').forEach(p=>{
    l.innerHTML+=`
    <div class="bg-white p-4 rounded-xl shadow-lg mb-3">
      <div class="font-bold text-lg">${p.name}</div>
      <div class="text-sm text-gray-600">${p.location}</div>
    </div>`;
  });
}

function renderUR(){
  const l=document.getElementById('url');
  if(reqs.length===0){
    l.innerHTML='<p class="text-gray-500 text-center py-8">No requests yet</p>';return;
  }
  l.innerHTML='';
  reqs.forEach(r=>{
    l.innerHTML+=`
    <div class="bg-white p-4 rounded shadow mb-3">
      <div class="font-bold">${r.issue}</div>
      <div class="text-sm text-gray-600">${r.location}</div>
      <div class="text-xs">${r.status}</div>
    </div>`;
  });
}

function renderAR(){
  const l=document.getElementById('arl'),
  or=reqs.filter(r=>r.status==='Open');
  if(or.length===0){
    l.innerHTML='<p class="text-gray-500 text-center py-8">No requests</p>';return;
  }
  l.innerHTML='';
  or.forEach(r=>{
    l.innerHTML+=`
    <div class="bg-white p-4 rounded shadow mb-3">
      <div class="font-bold">${r.issue}</div>
      <div class="text-sm text-gray-600">${r.location}</div>
      <button onclick="accept('${r.docId}')" class="mt-2 w-full bg-green-600 text-white py-2 rounded font-bold">Accept</button>
    </div>`;
  });
}

function renderMJ(){
  const l=document.getElementById('mjl'),
  mj=reqs.filter(r=>r.providerId===pid&&r.status==='In Progress');
  if(mj.length===0){
    l.innerHTML='<p class="text-gray-500 text-center py-8">No jobs</p>';return;
  }
  l.innerHTML='';
  mj.forEach(r=>{
    l.innerHTML+=`
    <div class="bg-white p-4 rounded shadow mb-3">
      <div class="font-bold">${r.issue}</div>
      <div class="text-sm text-gray-600">${r.location}</div>
      <button onclick="complete('${r.docId}')" class="mt-2 w-full bg-green-600 text-white py-2 rounded font-bold">Mark Complete</button>
    </div>`;
  });
}

async function accept(id){
  await updateDoc(doc(db,'requests',id),{status:'In Progress',providerId:pid});
  renderAR();
}

async function complete(id){
  await updateDoc(doc(db,'requests',id),{status:'Completed'});
  renderMJ();
}
</script>

</body>
</html>                                                                                                                                                                                                                                                                                                                                           

