<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>chapTAP Autofix</title>

  <!-- React -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-50">
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect } = React;
const ADMIN_PIN = "1234";

/* ---------------- ICONS (UNCHANGED) ---------------- */
const Wrench = ({size=24}) => <span>ðŸ”§</span>;
const Car = ({size=24}) => <span>ðŸš—</span>;
const Battery = ({size=24}) => <span>ðŸ”‹</span>;
const Fuel = ({size=24}) => <span>â›½</span>;
const Bell = () => <span>ðŸ””</span>;

/* ---------------- APP ---------------- */
function ChapTapAutofix() {
  const [userType, setUserType] = useState("user");
  const [currentView, setCurrentView] = useState("home");
  const [requests, setRequests] = useState([]);
  const [selectedIssue, setSelectedIssue] = useState("");
  const [location, setLocation] = useState("");

  const issueTypes = [
    { name: "Flat Tyre", icon: <Car/> },
    { name: "Battery", icon: <Battery/> },
    { name: "Fuel", icon: <Fuel/> },
    { name: "Towing", icon: <Wrench/> },
    { name: "Other / Not Listed", icon: <Wrench/> }
  ];

  function submitRequest() {
    if (!selectedIssue || !location) {
      alert("Please describe the problem and location");
      return;
    }

    setRequests([
      ...requests,
      {
        id: Date.now(),
        issue: selectedIssue,
        location,
        status: "Open",
        paymentStatus: "Pending"
      }
    ]);

    setSelectedIssue("");
    setLocation("");
    setCurrentView("home");
    alert("Request submitted successfully");
  }

  function openAdmin() {
    const pin = prompt("Enter Admin PIN");
    if (pin === ADMIN_PIN) {
      setUserType("admin");
      setCurrentView("admin");
    } else {
      alert("Unauthorized");
    }
  }

  return (
    <div className="max-w-md mx-auto min-h-screen pb-24">

      {/* TOP BAR */}
      <div className="bg-white border-b flex">
        <button
          className={`flex-1 py-4 font-semibold ${userType==="user"?"border-b-2 border-black":""}`}
          onClick={() => {setUserType("user"); setCurrentView("home");}}
        >
          Get Help
        </button>

        <button
          className="flex-1 py-4 font-semibold"
          onClick={openAdmin}
        >
          Admin
        </button>
      </div>

      {/* CONTENT */}
      <div className="p-4">

        {/* USER HOME */}
        {userType==="user" && currentView==="home" && (
          <>
            <div className="bg-black text-white rounded-xl p-6 text-center mb-6">
              <h1 className="text-3xl font-bold">chapTAP Autofix</h1>
              <p className="text-gray-300">Premium help. Anywhere.</p>
            </div>

            <button
              className="w-full bg-red-600 text-white py-4 rounded-xl font-bold mb-4"
              onClick={()=>setCurrentView("request")}
            >
              Request Help
            </button>

            {requests.length > 0 && (
              <div className="bg-white rounded-xl shadow p-4">
                <h3 className="font-bold mb-2">Your Requests</h3>
                {requests.map(r => (
                  <div key={r.id} className="border-b py-2 text-sm">
                    <div>{r.issue}</div>
                    <div className="text-gray-500">{r.location}</div>
                    <div className="text-xs">Status: {r.status}</div>
                  </div>
                ))}
              </div>
            )}
          </>
        )}

        {/* REQUEST FORM */}
        {userType==="user" && currentView==="request" && (
          <div className="bg-white rounded-xl shadow p-4">
            <h2 className="font-bold text-lg mb-4">Request Help</h2>

            <div className="grid grid-cols-2 gap-2 mb-4">
              {issueTypes.map(i => (
                <button
                  key={i.name}
                  className={`border rounded-lg p-2 ${selectedIssue===i.name?"border-black":""}`}
                  onClick={()=>setSelectedIssue(i.name)}
                >
                  {i.icon} {i.name}
                </button>
              ))}
            </div>

            <textarea
              className="w-full border rounded-lg p-2 mb-3"
              placeholder="Describe your location (home, office, roadside)"
              value={location}
              onChange={e=>setLocation(e.target.value)}
            />

            <input
              type="file"
              accept="image/*,video/*"
              className="w-full mb-3 text-sm"
            />

            <button
              className="w-full bg-black text-white py-3 rounded-lg"
              onClick={submitRequest}
            >
              Submit Request
            </button>
          </div>
        )}

        {/* ADMIN DASHBOARD */}
        {userType==="admin" && (
          <div>
            <h2 className="text-xl font-bold mb-4">Admin Dashboard</h2>

            <div className="bg-white rounded-xl shadow p-4 mb-4">
              <div>Total Requests: {requests.length}</div>
            </div>

            <div className="bg-white rounded-xl shadow p-4">
              <h3 className="font-semibold mb-2">Issue Breakdown</h3>
              {Object.entries(
                requests.reduce((a,r)=>{a[r.issue]=(a[r.issue]||0)+1; return a;}, {})
              ).map(([k,v])=>(
                <div key={k} className="flex justify-between text-sm">
                  <span>{k}</span><span>{v}</span>
                </div>
              ))}
            </div>
          </div>
        )}

      </div>

      {/* FOOTER */}
      <div className="fixed bottom-0 left-0 right-0 bg-white border-t text-center text-xs p-3">
        chapTAP Autofix MVP
      </div>

    </div>
  );
}

ReactDOM.render(<ChapTapAutofix />, document.getElementById("root"));
</script>
</body>
</html>
