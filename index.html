<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>chapTAP Autofix</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>body { padding-bottom: 100px; }</style>
</head>
<body class="bg-gray-50">
  
  <div class="bg-gradient-to-r from-black to-gray-900 border-b-4 border-yellow-500 p-6 text-center sticky top-0 z-50">
    <h1 class="text-3xl font-black"><span class="text-yellow-400">chap</span><span class="text-white">TAP</span></h1>
    <p class="text-yellow-200 text-xs">Autofix - Premium Roadside Assistance</p>
    <p id="gps" class="text-green-400 text-xs mt-1 hidden">üìç GPS Active</p>
    <div class="flex gap-2 justify-center mt-4">
      <button onclick="setRole('user')" id="ru" class="px-4 py-2 rounded font-bold text-xs bg-yellow-500 text-black">User</button>
      <button onclick="setRole('provider')" id="rp" class="px-4 py-2 rounded font-bold text-xs bg-gray-700 text-white">Provider</button>
      <button onclick="setRole('admin')" id="ra" class="px-4 py-2 rounded font-bold text-xs bg-gray-700 text-white">Admin</button>
    </div>
    <button onclick="showNotifs()" class="absolute top-6 right-6 text-yellow-400 text-2xl">üîî<span id="nb" class="text-xs bg-red-500 rounded-full px-1 hidden">0</span></button>
  </div>

  <div class="max-w-md mx-auto p-4">
    
    <!-- USER SECTION -->
    <div id="user">
      <div id="uh" class="space-y-4">
        <div id="ld" class="bg-green-50 border-l-4 border-green-500 p-3 rounded hidden">
          <p class="text-sm font-bold text-green-800">üìç Your Location</p>
          <p id="co" class="text-xs text-green-700"></p>
        </div>
        <button onclick="getLoc()" id="lb" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold">üìç Use My Location</button>
        <button onclick="show('em')" class="w-full bg-red-600 text-white py-4 rounded-xl font-black text-lg">üö® EMERGENCY HELP</button>
        <button onclick="show('pv')" class="w-full bg-black text-yellow-400 py-4 rounded-xl font-black">‚ö´üü° Find Providers</button>
        <button onclick="show('ur')" class="w-full bg-purple-600 text-white py-3 rounded-xl font-bold">My Requests (<span id="urc">0</span>)</button>
      </div>
      <div id="pv" class="space-y-4 hidden">
        <button onclick="show('uh')" class="text-blue-600 font-bold text-lg">‚Üê Back</button>
        <h2 class="text-2xl font-black">Service Providers</h2>
        <div id="pl"></div>
      </div>
      <div id="ur" class="space-y-4 hidden">
        <button onclick="show('uh')" class="text-blue-600 font-bold text-lg">‚Üê Back</button>
        <h2 class="text-2xl font-black">My Requests</h2>
        <div id="url"></div>
      </div>
    </div>

    <!-- PROVIDER SECTION -->
    <div id="provider" class="hidden">
      <div id="pl0" class="bg-white p-6 rounded-xl shadow-lg">
        <h3 class="text-xl font-bold mb-4">Provider Login</h3>
        <input type="tel" id="pp" placeholder="Phone Number" class="w-full p-3 border rounded mb-4">
        <button onclick="pLogin()" class="w-full bg-green-600 text-white py-2 rounded font-bold mb-2">Login</button>
        <button onclick="show('preg')" class="w-full bg-blue-600 text-white py-2 rounded font-bold">Register New Provider</button>
      </div>
      
      <div id="preg" class="bg-white p-6 rounded-xl shadow-lg hidden">
        <h3 class="text-xl font-bold mb-4">Provider Registration</h3>
        <input type="text" id="rname" placeholder="Business Name" class="w-full p-3 border rounded mb-3">
        <input type="tel" id="rphone" placeholder="Phone Number" class="w-full p-3 border rounded mb-3">
        <input type="text" id="rloc" placeholder="Location (e.g., Nyali)" class="w-full p-3 border rounded mb-3">
        <div class="mb-3">
          <label class="block font-bold mb-2 text-sm">Services Offered</label>
          <div class="space-y-2">
            <label class="flex items-center"><input type="checkbox" value="Towing" class="mr-2 srv"> Towing</label>
            <label class="flex items-center"><input type="checkbox" value="Tyre" class="mr-2 srv"> Tyre Repair</label>
            <label class="flex items-center"><input type="checkbox" value="Battery" class="mr-2 srv"> Battery</label>
            <label class="flex items-center"><input type="checkbox" value="Mechanical" class="mr-2 srv"> Mechanical</label>
            <label class="flex items-center"><input type="checkbox" value="Electrical" class="mr-2 srv"> Electrical</label>
          </div>
        </div>
        <button onclick="registerP()" class="w-full bg-green-600 text-white py-2 rounded font-bold">Submit Registration</button>
        <button onclick="show('pl0')" class="w-full bg-gray-300 py-2 rounded font-bold mt-2">Back</button>
      </div>

      <div id="pd" class="space-y-4 hidden">
        <div class="bg-green-600 text-white p-6 rounded-xl">
          <h2 class="text-2xl font-black" id="pn"></h2>
          <p class="text-sm" id="plc"></p>
          <button onclick="toggleA()" id="ab" class="mt-4 w-full py-3 rounded font-bold bg-red-600">üü¢ Go Offline</button>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div class="bg-white p-4 rounded shadow">
            <div class="text-2xl font-bold text-blue-600" id="tj">0</div>
            <div class="text-sm">Total Jobs</div>
          </div>
          <div class="bg-white p-4 rounded shadow">
            <div class="text-2xl font-bold text-green-600" id="cj">0</div>
            <div class="text-sm">Completed</div>
          </div>
        </div>
        <button onclick="show('ar')" class="w-full bg-blue-600 text-white py-3 rounded font-bold">Available Requests (<span id="arc">0</span>)</button>
        <button onclick="show('mj')" class="w-full bg-green-600 text-white py-3 rounded font-bold">My Jobs (<span id="mjc">0</span>)</button>
      </div>
      
      <div id="ar" class="space-y-4 hidden">
        <button onclick="show('pd')" class="text-blue-600 font-bold text-lg">‚Üê Back</button>
        <h2 class="text-2xl font-black">Available Requests</h2>
        <div id="arl"></div>
      </div>
      
      <div id="mj" class="space-y-4 hidden">
        <button onclick="show('pd')" class="text-blue-600 font-bold text-lg">‚Üê Back</button>
        <h2 class="text-2xl font-black">My Jobs</h2>
        <div id="mjl"></div>
      </div>
    </div>

    <!-- ADMIN SECTION -->
    <div id="admin" class="hidden">
      <div id="al" class="bg-white p-6 rounded-xl shadow-lg">
        <h3 class="text-xl font-bold mb-4">Admin Login</h3>
        <input type="password" id="ap" placeholder="PIN (1234)" class="w-full p-3 border rounded mb-4">
        <button onclick="aLogin()" class="w-full bg-blue-600 text-white py-2 rounded font-bold">Login</button>
      </div>
      
      <div id="ad" class="space-y-4 hidden">
        <h2 class="text-2xl font-black">Admin Dashboard</h2>
        <div class="flex gap-2 mb-4">
          <button onclick="showAdminTab('ad1')" id="atab1" class="flex-1 py-2 rounded font-bold bg-blue-600 text-white">Overview</button>
          <button onclick="showAdminTab('ad2')" id="atab2" class="flex-1 py-2 rounded font-bold bg-gray-300">Pending Providers</button>
        </div>
        
        <div id="ad1">
          <div class="grid grid-cols-2 gap-4">
            <div class="bg-blue-500 text-white p-4 rounded">
              <div class="text-2xl font-bold" id="atr">0</div>
              <div class="text-sm">Total Requests</div>
            </div>
            <div class="bg-green-500 text-white p-4 rounded">
              <div class="text-2xl font-bold" id="atp">0</div>
              <div class="text-sm">Providers</div>
            </div>
          </div>
          <div class="bg-white p-4 rounded shadow mt-4">
            <h3 class="font-bold mb-2">All Requests</h3>
            <div id="arl2"></div>
          </div>
        </div>
        
        <div id="ad2" class="hidden">
          <h3 class="text-xl font-bold mb-4">Pending Provider Approvals</h3>
          <div id="pendl"></div>
        </div>
      </div>
    </div>

  </div>

  <!-- EMERGENCY MODAL -->
  <div id="em" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50 hidden overflow-y-auto">
    <div class="bg-white rounded-xl p-6 max-w-md w-full my-8">
      <h3 class="text-xl font-bold mb-4">üö® Emergency Request</h3>
      <div id="mld" class="bg-green-50 border-l-4 border-green-500 p-2 rounded mb-3 text-xs hidden">
        <p class="font-bold text-green-800">üìç Location Detected</p>
        <p id="mco" class="text-green-700"></p>
      </div>
      <button onclick="getLoc()" id="mlb" class="w-full bg-blue-600 text-white py-2 rounded mb-3 font-bold hidden">üìç Use My Location</button>
      <select id="is" class="w-full p-3 border rounded mb-3">
        <option value="">Select issue...</option>
        <option>Engine Problem</option>
        <option>Battery Dead</option>
        <option>Flat Tyre</option>
        <option>Out of Fuel</option>
        <option>Accident</option>
        <option>Towing Needed</option>
        <option>Mechanical Issue</option>
        <option>Electrical Problem</option>
        <option>Other</option>
      </select>
      <input type="text" id="ci" placeholder="Specify issue..." class="w-full p-3 border rounded mb-3 hidden">
      <textarea id="loc" placeholder="Describe location..." class="w-full p-3 border rounded mb-3" rows="3"></textarea>
      <div class="mb-3">
        <label class="block font-bold mb-2 text-sm">üì∏ Upload Photos</label>
        <input type="file" multiple accept="image/*" id="ph" class="w-full p-2 border rounded text-sm">
        <div id="prev" class="grid grid-cols-3 gap-2 mt-2"></div>
      </div>
      <div class="grid grid-cols-2 gap-2 mb-3">
        <button onclick="setType('roadside')" id="tr" class="p-2 rounded border-2 bg-yellow-500 border-yellow-600 font-bold">üõ£Ô∏è Roadside</button>
        <button onclick="setType('home')" id="th" class="p-2 rounded border-2 border-gray-300 font-bold">üè† Home</button>
      </div>
      <div class="grid grid-cols-2 gap-2">
        <button onclick="submit()" class="bg-red-600 text-white py-2 rounded font-bold">Submit</button>
        <button onclick="hide('em')" class="bg-gray-300 py-2 rounded font-bold">Cancel</button>
      </div>
    </div>
  </div>

  <div class="bg-gradient-to-r from-black to-gray-900 border-t-4 border-yellow-500 p-4 text-center fixed bottom-0 left-0 right-0">
    <p class="font-black text-yellow-400">‚ö´üü° chapTAP Autofix</p>
    <p class="text-xs text-yellow-200">üìû support@chaptapautofix.co.ke</p>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFirestore, collection, addDoc, onSnapshot, updateDoc, doc, deleteDoc, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyC9bElB729BAemQgyloqaFSXOZhgqYjeFY",
      authDomain: "chaptap-autofix.firebaseapp.com",
      projectId: "chaptap-autofix",
      storageBucket: "chaptap-autofix.firebasestorage.app",
      messagingSenderId: "844892869830",
      appId: "1:844892869830:web:17a305b33d0679a068b3c7",
      measurementId: "G-7ZPVDQPSXT"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    window.db = db;
    window.collection = collection;
    window.addDoc = addDoc;
    window.onSnapshot = onSnapshot;
    window.updateDoc = updateDoc;
    window.doc = doc;
    window.deleteDoc = deleteDoc;
    window.query = query;
    window.orderBy = orderBy;

    console.log('‚úÖ Firebase connected!');
    window.initApp();
  </script>

  <script>
    let role='user',loc=null,type='roadside',pid=null,notifs=[],reqs=[],provs=[];

    window.initApp = function() {
      // Listen to providers collection
      onSnapshot(collection(db, 'providers'), (snapshot) => {
        provs = [];
        snapshot.forEach((doc) => {
          provs.push({ docId: doc.id, ...doc.data() });
        });
        console.log('Providers loaded:', provs.length);
        updateAllCounts();
      });

      // Listen to requests collection
      onSnapshot(query(collection(db, 'requests'), orderBy('timestamp', 'desc')), (snapshot) => {
        reqs = [];
        snapshot.forEach((doc) => {
          reqs.push({ docId: doc.id, ...doc.data() });
        });
        console.log('Requests loaded:', reqs.length);
        updateAllCounts();
      });

      // Initialize with default providers if empty
      setTimeout(() => {
        if (provs.length === 0) {
          addDefaultProviders();
        }
      }, 2000);

      getLoc();
    };

    async function addDefaultProviders() {
      const defaults = [
        {id: Date.now(), name: 'Mike Garage', phone: '0721122334', services: ['Towing','Tyre'], location: 'Nyali', lat: -4.0435, lng: 39.6682, rating: 4.5, status: 'Approved', available: true},
        {id: Date.now()+1, name: 'Quick Fix Auto', phone: '0733445566', services: ['Battery'], location: 'CBD', lat: -4.0559, lng: 39.6630, rating: 4.3, status: 'Approved', available: true}
      ];
      for (const p of defaults) {
        await addDoc(collection(db, 'providers'), p);
      }
    }

    function updateAllCounts() {
      document.getElementById('urc').textContent = reqs.length;
      document.getElementById('arc').textContent = reqs.filter(r => r.status === 'Open').length;
      document.getElementById('atr').textContent = reqs.length;
      document.getElementById('atp').textContent = provs.filter(p => p.status === 'Approved').length;
      
      if (pid) {
        const myJobs = reqs.filter(r => r.providerId === pid);
        document.getElementById('tj').textContent = myJobs.length;
        document.getElementById('cj').textContent = myJobs.filter(j => j.status === 'Completed').length;
        document.getElementById('mjc').textContent = myJobs.filter(j => j.status === 'In Progress').length;
      }
    }

    function dist(a,b,c,d){const R=6371,x=(c-a)*Math.PI/180,y=(d-b)*Math.PI/180,z=Math.sin(x/2)**2+Math.cos(a*Math.PI/180)*Math.cos(c*Math.PI/180)*Math.sin(y/2)**2;return(R*2*Math.atan2(Math.sqrt(z),Math.sqrt(1-z))).toFixed(1)}
    
    function addN(m){notifs.push({msg:m,time:new Date().toLocaleTimeString()});const b=document.getElementById('nb');b.textContent=notifs.length;b.classList.remove('hidden')}
    
    function showNotifs(){if(notifs.length===0){alert('No notifications')}else{alert(notifs.map(n=>`${n.time}: ${n.msg}`).join('\n\n'))}}
    
    function getLoc(){const b=document.getElementById('lb');b.textContent='Getting...';b.disabled=true;if(navigator.geolocation){navigator.geolocation.getCurrentPosition(p=>{loc={lat:p.coords.latitude,lng:p.coords.longitude};const t=`Lat: ${loc.lat.toFixed(4)}, Lng: ${loc.lng.toFixed(4)}`;document.getElementById('co').textContent=t;document.getElementById('ld').classList.remove('hidden');document.getElementById('gps').classList.remove('hidden');b.classList.add('hidden');document.getElementById('mco').textContent=t;document.getElementById('mld').classList.remove('hidden');document.getElementById('mlb').classList.add('hidden');addN('Location detected!')},()=>{alert('Enable GPS');b.textContent='üìç Use My Location';b.disabled=false})}else{alert('Not supported');b.textContent='üìç Use My Location';b.disabled=false}}
    
    function setRole(r){role=r;['user','provider','admin'].forEach(x=>{document.getElementById('r'+x[0]).className=x===r?'px-4 py-2 rounded font-bold text-xs bg-yellow-500 text-black':'px-4 py-2 rounded font-bold text-xs bg-gray-700 text-white'});document.getElementById('user').classList.toggle('hidden',r!=='user');document.getElementById('provider').classList.toggle('hidden',r!=='provider');document.getElementById('admin').classList.toggle('hidden',r!=='admin');if(r==='user')show('uh');if(r==='provider'){show('pl0');hide('pd')}if(r==='admin'){show('al');hide('ad')}}
    
    function show(id){document.querySelectorAll('#user>div,#provider>div').forEach(e=>e.classList.add('hidden'));document.getElementById(id).classList.remove('hidden');if(id==='pv')renderP();if(id==='ur')renderUR();if(id==='ar')renderAR();if(id==='mj')renderMJ();if(id==='em'&&!loc)document.getElementById('mlb').classList.remove('hidden')}
    
    function hide(id){document.getElementById(id).classList.add('hidden');if(id==='em'){document.getElementById('is').value='';document.getElementById('ci').classList.add('hidden');document.getElementById('loc').value='';document.getElementById('prev').innerHTML='';document.getElementById('ph').value=''}}
    
    function showAdminTab(id){document.getElementById('ad1').classList.toggle('hidden', id!=='ad1');document.getElementById('ad2').classList.toggle('hidden', id!=='ad2');document.getElementById('atab1').className = id==='ad1'?'flex-1 py-2 rounded font-bold bg-blue-600 text-white':'flex-1 py-2 rounded font-bold bg-gray-300';document.getElementById('atab2').className = id==='ad2'?'flex-1 py-2 rounded font-bold bg-blue-600 text-white':'flex-1 py-2 rounded font-bold bg-gray-300';if(id==='ad1')updateA();if(id==='ad2')updatePendingList()}
    
    function renderP(){const l=document.getElementById('pl');l.innerHTML='';provs.filter(p=>p.status==='Approved').forEach(p=>{const d=loc?dist(loc.lat,loc.lng,p.lat,p.lng):null;l.innerHTML+=`<div class="bg-white p-4 rounded-xl shadow-lg"><div class="flex justify-between mb-2"><div><div class="font-bold text-lg">${p.name}</div><div class="text-sm text-gray-600">üìç ${p.location}</div>${d?`<div class="text-xs text-blue-600 font-bold">üìè ${d} km away</div>`:''}<div class="text-sm text-blue-600">${p.services.join(', ')}</div><div class="inline-block mt-1 px-2 py-1 rounded text-xs font-bold ${p.available?'bg-green-100 text-green-700':'bg-red-100 text-red-700'}">${p.available?'Available':'Busy'}</div></div><div>‚≠ê ${p.rating}</div></div><div class="grid grid-cols-3 gap-2"><a href="tel:${p.phone}" class="bg-blue-600 text-white py-2 rounded text-center text-xs">üìû Call</a><a href="https://wa.me/254${p.phone.substring(1)}" target="_blank" class="bg-green-600 text-white py-2 rounded text-center text-xs">üí¨ Chat</a><a href="https://www.google.com/maps/dir/?api=1&destination=${p.lat},${p.lng}" target="_blank" class="bg-gray-700 text-white py-2 rounded text-center text-xs">üó∫Ô∏è Route</a></div></div>`})}
    
    function renderUR(){const l=document.getElementById('url');if(reqs.length===0){l.innerHTML='<p class="text-gray-500 text-center py-8">No requests yet</p>';return}l.innerHTML='';reqs.forEach(r=>{const sc=r.status==='Open'?'bg-yellow-100 text-yellow-800':r.status==='In Progress'?'bg-blue-100 text-blue-800':'bg-green-100 text-green-800';l.innerHTML+=`<div class="bg-white p-4 rounded shadow mb-3"><div class="flex justify-between"><div class="flex-1"><div class="font-bold">${r.issue}</div><div class="text-sm text-gray-600">${r.location}</div>${r.photos&&r.photos.length>0?`<div class="text-xs text-gray-500 mt-1">üì∏ ${r.photos.length} photo(s)</div>`:''}</div><div class="px-2 py-1 rounded text-xs font-bold h-fit ${sc}">${r.status}</div></div></div>`})}
    
    function setType(t){type=t;if(t==='roadside'){document.getElementById('tr').className='p-2 rounded border-2 bg-yellow-500 border-yellow-600 font-bold';document.getElementById('th').className='p-2 rounded border-2 border-gray-300 font-bold'}else{document.getElementById('th').className='p-2 rounded border-2 bg-yellow-500 border-yellow-600 font-bold';document.getElementById('tr').className='p-2 rounded border-2 border-gray-300 font-bold'}}
    
    async function submit(){const i=document.getElementById('is').value,c=document.getElementById('ci').value,l=document.getElementById('loc').value;if(!i||!l){alert('Fill all fields');return}const fi=i==='Other'?c:i,pf=Array.from(document.getElementById('ph').files).map(f=>f.name);await addDoc(collection(db, 'requests'), {id:Date.now(),issue:fi,location:l,type:type,photos:pf,userLat:loc?.lat,userLng:loc?.lng,status:'Open',timestamp:new Date().toISOString()});addN('Emergency submitted!');hide('em');alert('‚úÖ Request submitted!')}
    
    function pLogin(){const ph=document.getElementById('pp').value,p=provs.find(x=>x.phone===ph&&x.status==='Approved');if(p){pid=p.id;hide('pl0');show('pd');document.getElementById('pn').textContent=p.name;document.getElementById('plc').textContent=p.location;updateAllCounts()}else alert('Not found or not approved yet')}
    
    async function registerP(){const n=document.getElementById('rname').value,ph=document.getElementById('rphone').value,l=document.getElementById('rloc').value,s=Array.from(document.querySelectorAll('.srv:checked')).map(x=>x.value);if(!n||!ph||!l||s.length===0){alert('Fill all fields');return}await addDoc(collection(db, 'providers'), {id:Date.now(),name:n,phone:ph,services:s,location:l,lat:-4.05+(Math.random()*0.1),lng:39.66+(Math.random()*0.1),rating:0,status:'Pending',available:false});addN('Registration submitted!');alert('‚úÖ Registration submitted!');show('pl0');document.getElementById('rname').value='';document.getElementById('rphone').value='';document.getElementById('rloc').value='';document.querySelectorAll('.srv').forEach(x=>x.checked=false)}
    
    async function toggleA(){const p=provs.find(x=>x.id===pid);p.available=!p.available;await updateDoc(doc(db, 'providers', p.docId), {available:p.available});const b=document.getElementById('ab');b.textContent=p.available?'üü¢ Go Offline':'üî¥ Go Online';b.className=p.available?'mt-4 w-full py-3 rounded font-bold bg-red-600':'mt-4 w-full py-3 rounded font-bold bg-white text-green-700'}
    
    function renderAR(){const l=document.getElementById('arl'),or=reqs.filter(r=>r.status==='Open');if(or.length===0){l.innerHTML='<p class="text-gray-500 text-center py-8">No requests</p>';return}l.innerHTML='';or.forEach(r=>{const ml=r.userLat&&r.userLng?`<a href="https://www.google.com/maps/dir/?api=1&destination=${r.userLat},${r.userLng}" target="_blank" class="text-xs text-blue-600 underline block mt-1">üó∫Ô∏è Get Directions</a>`:'';l.innerHTML+=`<div class="bg-white p-4 rounded shadow mb-3"><div class="font-bold">${r.issue}</div><div class="text-sm text-gray-600">${r.location}</div>${r.photos&&r.photos.length>0?`<div class="text-xs text-gray-500 mt-1">üì∏ ${r.photos.length} photo(s)</div>`:''}${ml}<button onclick="accept('${r.docId}')" class="mt-2 w-full bg-green-600 text-white py-2 rounded font-bold">Accept</button></div>`})}
    
    async function accept(docId){const r=reqs.find(x=>x.docId===docId);await updateDoc(doc(db, 'requests', docId), {status:'In Progress',providerId:pid});addN('Request accepted!');renderAR()}
    
    function renderMJ(){const l=document.getElementById('mjl'),mj=reqs.filter(r=>r.providerId===pid&&r.status==='In Progress');if(mj.length===0){l.innerHTML='<p class="text-gray-500 text-center py-8">No jobs</p>';return}l.innerHTML='';mj.forEach(r=>{const ml=r.userLat&&r.userLng?`<a href="https://www.google.com/maps/dir/?api=1&destination=${r.

    <function_calls>
<invoke name="artifacts">
<parameter name="command">update</parameter>
<parameter name="id">chaptap-firebase-complete</parameter>
<parameter name="old_str">    function renderMJ(){const l=document.getElementById('mjl'),mj=reqs.filter(r=>r.providerId===pid&&r.status==='In Progress');if(mj.length===0){l.innerHTML='<p class="text-gray-500 text-center py-8">No jobs</p>';return}l.innerHTML='';mj.forEach(r=>{const ml=r.userLat&&r.userLng?<a href="https://www.google.com/maps/dir/?api=1&destination=${r.</parameter> <parameter name="new_str">    function renderMJ(){const l=document.getElementById('mjl'),mj=reqs.filter(r=>r.providerId===pid&&r.status==='In Progress');if(mj.length===0){l.innerHTML='<p class="text-gray-500 text-center py-8">No jobs</p>';return}l.innerHTML='';mj.forEach(r=>{const ml=r.userLat&&r.userLng?<a href="https://www.google.com/maps/dir/?api=1&destination=${r.userLat},${r.userLng}" target="_blank" class="text-xs text-blue-600 underline block mt-1">üó∫Ô∏è Navigate</a>:'';l.innerHTML+=<div class="bg-white p-4 rounded shadow mb-3"><div class="font-bold">${r.issue}</div><div class="text-sm text-gray-600">${r.location}</div>${ml}<button onclick="complete('${r.docId}')" class="mt-2 w-full bg-green-600 text-white py-2 rounded font-bold">Mark Complete</button></div>`})}
async function complete(docId){await updateDoc(doc(db, 'requests', docId), {status:'Completed'});addN('Job completed!');renderMJ()}

function aLogin(){if(document.getElementById('ap').value==='1234'){hide('al');show('ad');showAdminTab('ad1')}else alert('Wrong PIN')}

function updateA(){document.getElementById('atr').textContent=reqs.length;document.getElementById('atp').textContent=provs.filter(p=>p.status==='Approved').length;const l=document.getElementById('arl2');if(reqs.length===0){l.innerHTML='<p class="text-gray-500 py-4 text-center">No requests yet</p>';return}l.innerHTML='';reqs.forEach(r=>{l.innerHTML+=`<div class="border-b py-2"><div class="font-semibold">${r.issue}</div><div class="text-sm text-gray-600">${r.location} - ${r.status}</div></div>`})}

function updatePendingList(){const l=document.getElementById('pendl'),pending=provs.filter(p=>p.status==='Pending');if(pending.length===0){l.innerHTML='<p class="text-gray-500 text-center py-8">No pending providers</p>';return}l.innerHTML='';pending.forEach(p=>{l.innerHTML+=`<div class="bg-white p-4 rounded shadow mb-3"><div class="font-bold text-lg">${p.name}</div><div class="text-sm text-gray-600">üìû ${p.phone}</div><div class="text-sm text-gray-600">üìç ${p.location}</div><div class="text-sm text-blue-600 mt-1">Services: ${p.services.join(', ')}</div><div class="grid grid-cols-2 gap-2 mt-3"><button onclick="approveP('${p.docId}')" class="bg-green-600 text-white py-2 rounded font-bold">‚úÖ Approve</button><button onclick="rejectP('${p.docId}')" class="bg-red-600 text-white py-2 rounded font-bold">‚ùå Reject</button></div></div>`})}

async function approveP(docId){await updateDoc(doc(db, 'providers', docId), {status:'Approved',available:true,rating:4.0});addN('Provider approved!');alert('‚úÖ Provider approved!');updatePendingList()}

async function rejectP(docId){if(confirm('Reject this provider?')){await deleteDoc(doc(db, 'providers', docId));alert('Provider rejected');updatePendingList()}}

document.getElementById('is').addEventListener('change',e=>{document.getElementById('ci').classList.toggle('hidden',e.target.value!=='Other')});
document.getElementById('ph').addEventListener('change',e=>{const p=document.getElementById('prev');p.innerHTML='';Array.from(e.target.files).forEach(f=>{const r=new FileReader();r.onload=ev=>{const i=document.createElement('img');i.src=ev.target.result;i.className='w-full h-20 object-cover rounded border';p.appendChild(i)};r.readAsDataURL(f)})});
  </script>
</body>
</html>                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                       
